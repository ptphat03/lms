{% extends 'base.html' %}

{% block title %}{{ course.title }}{% endblock %}

{% block content %}
<style>
    .active a {
        color: white; /* Change text color to white for active lesson */
        background-color: #007bff; /* Optional: Set a background color for the active item */
    }
    .scrollable {
        height: 80vh; /* Set your desired height */
        overflow-y: auto; /* Enable vertical scrolling */
        overflow-x: hidden; /* Disable horizontal scrolling (optional) */
        border: 1px solid #ccc; /* Optional: add a border for better visibility */
        padding: 10px; /* Optional: add some padding */
    }

    .fixed-bottom-right {
    position: fixed; /* Fixed positioning */
    bottom: 20px;    /* Distance from the bottom of the viewport */
    right: 20px;     /* Distance from the right side of the viewport */
    z-index: 1000;   /* Ensure it's above other content */
}

</style>
    <h1>{{ course.title }}</h1>
    <p>{{ course.description }}</p>

   
        <div class="row">
            <div class="col-md-3 scrollable">
                <h3>Lessons</h3>
                <ul class="list-group">
                    {% for lesson in lessons %}
                        <li class="list-group-item">
                            <a href="#" data-lesson-id="{{ lesson.id }}">{{ lesson.title }}</a>
                        </li>
                    {% empty %}
                        <li class="list-group-item">No lessons available for this subject.</li>
                    {% endfor %}
                </ul>
                <div class="fixed-bottom-right">
                    <a href="{% url 'student_materials:subject_list' %}" class="btn btn-primary mt-3">Back to list</a>
                </div>
                
            </div>
            
            <div class="col-md-9 scrollable">
                <h3>Lesson Content</h3>
                {% if lessons %}
                    {% for lesson in lessons %}
                        <div id="lesson-{{ lesson.id }}" class="lesson-content scrollable" style="display:none;">
                            <h4>{{ lesson.title }}</h4>
                            <p>{{ lesson.description }}</p>
                            <div>{{ lesson.content|safe }}</div>  <!-- Render the rich text content -->
                            <h3>Materials</h3>
                            <ul>
                                {% for material in lesson.materials.all %}
                                <li>
                                    {% if material.file %}
                                        <a href="{{ material.file.url }}" target="_blank">{{ material.file.name }}</a>
                                    {% elif material.google_drive_link %}
                                        <a href="{{ material.google_drive_link }}" target="_blank">{{ material.material_type}} - Google Drive Link</a>
                                    {% else %}
                                        No material available.
                                    {% endif %}
                                </li>
                                {% empty %}
                                    <li>No materials available for this lesson.</li>
                                {% endfor %}
                            </ul>
                        </div>
                    {% endfor %}
                {% endif %}
                
            </div>
            
        </div>

    
    
    <script>
    // JavaScript to show/hide lesson content and activate the selected menu item
    document.querySelectorAll('.list-group-item a').forEach(function(link) {
        link.addEventListener('click', function(e) {
            e.preventDefault();  // Prevent default link behavior
    
            // Get the lesson ID from the data attribute
            var lessonId = this.getAttribute('data-lesson-id');
            
            // Hide all lesson contents
            document.querySelectorAll('.lesson-content').forEach(function(content) {
                content.style.display = 'none';
            });
            
            // Show the selected lesson content
            var lessonContent = document.getElementById('lesson-' + lessonId);
            if (lessonContent) {
                lessonContent.style.display = 'block';
            } else {
                console.error('Lesson content not found for ID: ' + lessonId);
            }

            // Remove 'active' class from all list items
            document.querySelectorAll('.list-group-item').forEach(function(item) {
                item.classList.remove('active');
            });
            
            // Add 'active' class to the clicked item
            this.parentElement.classList.add('active');
        });
    });

    // Optionally, you can show the first lesson by default if needed
    if (document.querySelector('.lesson-content')) {
        document.querySelector('.lesson-content').style.display = 'block';
        document.querySelector('.list-group-item').classList.add('active');  // Make the first item active by default
    }
    </script>
{% endblock %}
