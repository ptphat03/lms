{% extends "base.html" %}

{% block content %}
<!-- Book Search Section -->
<style>
    body {
        font-family: Arial, sans-serif;
        line-height: 1.6;
        margin: 0;
        padding: 0px;
        background-color: #f0f0f0;
    }
    .container {
        max-width: 1200px;
        margin: 0 auto;
        background-color: #ffffff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
</style>
<body>
<div class="container">
    <div style="text-align: center; margin-top: -30px; background-color: #3498db; padding: 20px 0; width: 100vw; position: relative; left: 50%; right: 50%; margin-left: -50vw; margin-right: -50vw; border-radius: 10px;">
        <h1 style="color:#ebf1ee;">Book Search</h1>

        <form method="GET" action="{% url 'book_search' %}" style="display: inline-block; margin-top: 1px">
            <div style="display: inline-block; position: relative;">
                <input type="text" name="q" placeholder="Search for books..." value="{{ query }}" required style="padding: 10px 15px; width: 300px; border: 1px solid #3498db; border-radius: 25px; font-size: 1rem;">
                <button type="submit" style="padding: 10px 20px; position: absolute; right: -90px; top: 0; background-color: #35DBB2; color: #ebf1ee; border: none; border-radius: 25px; cursor: pointer; font-size: 1rem;">Search</button>
            </div>
            
            <!-- Radio buttons for selecting book type -->
            <div style="margin-top: 10px;">
                <input type="radio" id="free" name="book_type" value="free" {% if request.GET.book_type == "free" or not request.GET.book_type %}checked{% endif %} onchange="this.form.submit()">
                <label for="free" style="color:#ebf1ee;">Free Books</label>

                <input type="radio" id="paid" name="book_type" value="paid" {% if request.GET.book_type == "paid" %}checked{% endif %} onchange="this.form.submit()">
                <label for="paid" style="color:#ebf1ee;">Paid Books</label>
            </div>
        </form> 
    </div>

    <!-- Book Results Section -->
    <div style="margin-top: 30px;">
        {% if query %}
            <h2>Book Search Results for "{{ query }}"</h2>
        {% endif %}

        {% if books %}
            <ul style="list-style-type: none; padding: 0; text-align: center;">
            {% for book in books %}
                <li style="display: flex; align-items: flex-start; margin-bottom: 20px; padding: 15px; border: 1px solid #ccc; border-radius: 8px; background-color: #7EB6DB;">
                    {% if book.thumbnail %}
                        <div style="flex-shrink: 0;">
                            <img src="{{ book.thumbnail }}" alt="Book cover of {{ book.title }}" style="max-width: 150px;"/>
                        </div>
                    {% else %}
                        <div style="flex-shrink: 0;">
                            <p>No image available</p>
                        </div>
                    {% endif %}
                    
                    <div style="margin-left: 15px; flex-grow: 1; text-align: left;">
                        <h3>{{ book.title }}</h3>
                        <p style="font-size: 0.9em;"><strong>Author(s):</strong> {{ book.authors|join:", " }}</p>
                        <p style="font-size: 0.8em;"><strong>Description:</strong> {{ book.description }}</p>
                        <p style="font-size: 0.8em;"><strong>Publisher:</strong> {{ book.publisher }}</p>
                        <p style="font-size: 0.8em;"><strong>Published Date:</strong> {{ book.publishedDate }}</p>
                        <p>
                            <a href="{{ book.infoLink }}" target="_blank">Read more about this book</a>
                            {% if book.previewLink %}
                                | <a href="{{ book.previewLink }}" target="_blank">Read Preview</a>
                            {% endif %}
                        </p>
                    </div>
                </li>
            {% endfor %}
            </ul>
        {% else %}
            <div style="background-color: #f8d7da; color: #721c24; padding: 15px; border: 1px solid #f5c6cb; border-radius: 8px; max-width: 600px; margin: 0 auto;">
                <h3 style="margin: 0 0 10px 0;">No books found for "{{ query }}"</h3>
                <p>Please try a different search term.</p>
            </div>
        {% endif %}
    </div>

    <!-- Pagination Controls -->
    <div style="text-align: center; margin-top: 20px;">
        <div>
            {% if books.has_previous %}
                <a href="?q={{ query|urlencode }}&book_type={{ book_type }}&page=1">&laquo; First</a>
                <a href="?q={{ query|urlencode }}&book_type={{ book_type }}&page={{ books.previous_page_number }}">Previous</a>
            {% else %}
                <span>&laquo; First</span>
                <span>Previous</span>
            {% endif %}

            {% comment %} Dynamic pagination range {% endcomment %}
            {% for page_num in paginator.page_range %}
                {% if page_num >= books.number|add:-5 and page_num <= books.number|add:5 %}
                    {% if page_num == books.number %}
                        <strong>{{ page_num }}</strong>  <!-- Highlight current page -->
                    {% else %}
                        <a href="?q={{ query|urlencode }}&book_type={{ book_type }}&page={{ page_num }}">{{ page_num }}</a>
                    {% endif %}
                {% endif %}
            {% endfor %}

            {% if books.has_next %}
                <a href="?q={{ query|urlencode }}&book_type={{ book_type }}&page={{ books.next_page_number }}">Next</a>
                <a href="?q={{ query|urlencode }}&book_type={{ book_type }}&page={{ paginator.num_pages }}">Last &raquo;</a>
            {% else %}
                <span>Next</span>
                <span>Last &raquo;</span>
            {% endif %}
        </div>
    </div>
</div>
</body>
{% endblock %}
